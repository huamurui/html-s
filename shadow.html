<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>shadow</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      #playground {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
        width: 100vw;
        height: 100vh;
        background-color: #f5f5f5;
      }

      #tag-list {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        flex-wrap: wrap;
        width: 200px;
        height: 100%;
        background-color: #f5f5f5;
      }

      #recommendation-list {
        flex:1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
      }

      .tag {
        height: 20px;
        padding: 5px;
        margin: 2px;
        border: 1px solid #ccc;
        border-radius: 30px;
        cursor: pointer;
        user-select: none;
      }

      .item {
        height: 20px;
        padding: 5px;
        margin: 2px;
        border: 1px solid #ccc;
        border-radius: 5px;
        cursor: pointer;
        user-select: none;
      }
    </style>
  </head>
  <body>
    <div id="playground">
      <div id="tag-list"></div>
      <hr />
      <div id="recommendation-list"></div>
    </div>
    <script>
      // i want to make a simple recommendation engine

      // 1. i need to create a list of items and their attributes/tags(stable)
      // 2. i need to create one user and its preferences/tags(dynamic)
      // 3. i need to create a list of ratings
      // 4. i need to create a list of recommendations

      // the example ... i want to recommend food to people based on their preferences
      const tagsWithPreferences = [
        {
          name: "spicy",
          weight: 0.5,
        },
        {
          name: "sweet",
          weight: 0.5,
        },
        {
          name: "sour",
          weight: 0.5,
        },
        {
          name: "bitter",
          weight: 0.5,
        },
        {
          name: "salty",
          weight: 0.5,
        },
        {
          name: "savory",
          weight: 0.5,
        },
        {
          name: "meat",
          weight: 0.5,
        },
        {
          name: "vegetable",
          weight: 0.5,
        },
        {
          name: "fruit",
          weight: 0.5,
        },
        {
          name: "cereal",
          weight: 0.5,
        },
        {
          name: "staplefood",
          weight: 0.5,
        },
        {
          name: "dessert",
          weight: 0.5,
        },
        {
          name: "soup",
          weight: 0.5,
        },
        {
          name: "fried",
          weight: 0.5,
        },
        {
          name: "steamed",
          weight: 0.5,
        },
        {
          name: "baked",
          weight: 0.5,
        },
      ];

      const items = [
        {
          name: "chicken rice",
          score: 0,
          tags: ["meat", "staplefood", "savory", "soup", "steamed"],
        },
        {
          name: "chicken chop",
          score: 0,
          tags: ["meat", "staplefood", "savory", "fried"],
        },
        {
          name: "chicken soup",
          score: 0,
          tags: ["meat", "soup", "savory", "steamed"],
        },
        {
          name: "apple pie",
          score: 0,
          tags: ["dessert", "sweet", "baked", "fruit"],
        },
        {
          name: "apple juice",
          score: 0,
          tags: ["drink", "sweet", "fruit"],
        },
        {
          name: "apple",
          score: 0,
          tags: ["fruit", "sweet"],
        },
        {
          name: "beef noodles",
          score: 0,
          tags: ["meat", "staplefood", "savory", "soup"],
        },
        {
          name: "toasted fish",
          score: 0,
          tags: ["meat", "staplefood", "savory", "fried"],
        },
        {
          name: "fish soup",
          score: 0,
          tags: ["meat", "soup", "savory", "steamed"],
        },
        {
          name: "banana pie",
          score: 0,
          tags: ["dessert", "sweet", "baked", "fruit"],
        },
        {
          name: "banana juice",
          score: 0,
          tags: ["drink", "sweet", "fruit"],
        },
        {
          name: "banana",
          score: 0,
          tags: ["fruit", "sweet"],
        },
        {
          name: "pork noodles",
          score: 0,
          tags: ["meat", "staplefood", "savory", "soup"],
        },
        {
          name: "toasted pork",
          score: 0,
          tags: ["meat", "staplefood", "savory", "fried"],
        },
        {
          name: "pork soup",
          score: 0,
          tags: ["meat", "soup", "savory", "steamed"],
        },
        {
          name: "orange pie",
          score: 0,
          tags: ["dessert", "sweet", "baked", "fruit"],
        },
        {
          name: "orange juice",
          score: 0,
          tags: ["drink", "sweet", "fruit"],
        },
        {
          name: "orange",
          score: 0,
          tags: ["fruit", "sweet"],
        },
        {
          name: "mutton noodles",
          score: 0,
          tags: ["meat", "staplefood", "savory", "soup"],
        },
        {
          name: "toasted mutton",
          score: 0,
          tags: ["meat", "staplefood", "savory", "fried"],
        },
        {
          name: "mutton soup",
          score: 0,
          tags: ["meat", "soup", "savory", "steamed"],
        },
        {
          name: "pear pie",
          score: 0,
          tags: ["dessert", "sweet", "baked", "fruit"],
        },
        {
          name: "pear juice",
          score: 0,
          tags: ["drink", "sweet", "fruit"],
        },
        {
          name: "pear",
          score: 0,
          tags: ["fruit", "sweet"],
        },
        {
          name: "lamb noodles",
          score: 0,
          tags: ["meat", "staplefood", "savory", "soup"],
        },
        {
          name: "toasted lamb",
          score: 0,
          tags: ["meat", "staplefood", "savory", "fried"],
        },
      ];

      let itemsWithRecommendation = [];

      function renderTagList() {
        const tagList = document.getElementById("tag-list");
        tagList.innerHTML = "";
        tagsWithPreferences.forEach((tag) => {
          const tagElement = document.createElement("div");
          tagElement.innerText = tag.name + " " + tag.weight.toFixed(1);
          tagElement.classList.add("tag");
          tagElement.addEventListener("click", () => {
            handleTagClick(tag);
          });
          tagList.appendChild(tagElement);
        });
      }

      function renderRecommendationList() {
        const recommendationList = document.getElementById(
          "recommendation-list"
        );
        recommendationList.innerHTML = "";
        itemsWithRecommendation.forEach((item) => {
          const itemElement = document.createElement("div");
          itemElement.innerText = item.name + " " + item.score.toFixed(2);
          itemElement.classList.add("item");
          recommendationList.appendChild(itemElement);
        });
      }

      function handleTagClick(tag) {
        tagsWithPreferences.forEach((tagWithPreference) => {
          if (tagWithPreference.name === tag.name) {
            tagWithPreference.weight += 0.1;
          } else {
            tagWithPreference.weight -= 0.1 / (tagsWithPreferences.length - 1);
          }
        });

        getItemsWithRecommendation();
        renderRecommendationList();
        renderTagList();
      }

      function getItemsWithRecommendation() {
        itemsWithRecommendation = [];
        items.forEach((item) => {
          let score = 0;
          const tagNum = item.tags.length;
          item.tags.forEach((tag) => {
            tagsWithPreferences.forEach((tagWithPreference) => {
              if (tagWithPreference.name === tag) {
                score += tagWithPreference.weight / tagNum;
              }
            });
          });
          item.score = score;
          itemsWithRecommendation.push(item);
        });

        itemsWithRecommendation.sort((a, b) => {
          return b.score - a.score;
        });
        itemsWithRecommendation = itemsWithRecommendation.slice(0, 5);
        console.log(tagsWithPreferences, itemsWithRecommendation);
      }

      renderTagList();
      getItemsWithRecommendation();
      renderRecommendationList();
    </script>
  </body>
</html>
